"use strict";var b=Object.create;var c=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var v=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var R=(n,e)=>{for(var t in e)c(n,t,{get:e[t],enumerable:!0})},f=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of v(e))!A.call(n,a)&&a!==t&&c(n,a,{get:()=>e[a],enumerable:!(r=S(e,a))||r.enumerable});return n};var u=(n,e,t)=>(t=n!=null?b(x(n)):{},f(e||!n||!n.__esModule?c(t,"default",{value:n,enumerable:!0}):t,n)),q=n=>f(c({},"__esModule",{value:!0}),n);var o=(n,e,t)=>new Promise((r,a)=>{var d=s=>{try{i(t.next(s))}catch(p){a(p)}},l=s=>{try{i(t.throw(s))}catch(p){a(p)}},i=s=>s.done?r(s.value):Promise.resolve(s.value).then(d,l);i((t=t.apply(n,e)).next())});var I={};R(I,{PaymentsController:()=>y});module.exports=q(I);var Y=require("dotenv/config"),m=u(require("mercadopago")),g=u(require("dayjs"));m.default.configurations.setAccessToken(String(process.env.MERCADO_PAGO_KEY_PROD));var _=class{static createPayment(e){return o(this,null,function*(){var a;let t={transaction_amount:e.transaction_amount,payment_method_id:"pix",payer:{email:e.payer.email},installments:1,date_of_expiration:String((0,g.default)(new Date).add(10,"minutes").format("YYYY-MM-DDTHH:mm:ss.000ZZ"))};return yield(a=m.default.payment)==null?void 0:a.save(t)})}static GetPayment(e){return o(this,null,function*(){return yield m.default.payment.findById(e)})}};var T=require("dotenv/config"),P=u(require("mysql2")),w=P.default.createPool({host:process.env.MYSQL_HOST,user:process.env.MYSQL_USER,database:process.env.MYSQL_DATABASE,password:process.env.MYSQL_PASSWORD,waitForConnections:!0,connectionLimit:10,maxIdle:10,idleTimeout:6e4,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0,charset:"utf8mb4"}),M=w.promise();var y=class{static checkPayment(e,t){return o(this,null,function*(){try{let r=Number(e.body.id),a=yield _.GetPayment(r),d=a.response.status_detail,l=a.response.status,[i]=yield M.query("UPDATE transactions AS T SET m_status= ?, m_status_detail=? WHERE m_id =? ",[l,d,r]);return t.json({id:a.response.transaction_details.transaction_id})}catch(r){return t.json({id:{},error:r})}})}static webhook(e,t){return o(this,null,function*(){})}};0&&(module.exports={PaymentsController});
