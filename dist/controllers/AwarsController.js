"use strict";var O=Object.create;var l=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var C=(n,e)=>{for(var t in e)l(n,t,{get:e[t],enumerable:!0})},S=(n,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of b(e))!A.call(n,a)&&a!==t&&l(n,a,{get:()=>e[a],enumerable:!(o=P(e,a))||o.enumerable});return n};var g=(n,e,t)=>(t=n!=null?O(I(n)):{},S(e||!n||!n.__esModule?l(t,"default",{value:n,enumerable:!0}):t,n)),v=n=>S(l({},"__esModule",{value:!0}),n);var i=(n,e,t)=>new Promise((o,a)=>{var m=r=>{try{s(t.next(r))}catch(c){a(c)}},_=r=>{try{s(t.throw(r))}catch(c){a(c)}},s=r=>r.done?o(r.value):Promise.resolve(r.value).then(m,_);s((t=t.apply(n,e)).next())});var w={};C(w,{AwarsController:()=>f});module.exports=v(w);var q=require("dotenv/config"),d=g(require("mercadopago")),E=g(require("dayjs"));d.default.configurations.setAccessToken(String(process.env.MERCADO_PAGO_KEY_PROD));var p=class{static createPayment(e){return i(this,null,function*(){var a;let t={transaction_amount:e.transaction_amount,payment_method_id:"pix",payer:{email:e.payer.email},installments:1,date_of_expiration:String((0,E.default)(new Date).add(10,"minutes").format("YYYY-MM-DDTHH:mm:ss.000ZZ"))};return yield(a=d.default.payment)==null?void 0:a.save(t)})}static GetPayment(e){return i(this,null,function*(){return yield d.default.payment.findById(e)})}};var h=require("dotenv/config"),M=g(require("mysql2")),x=M.default.createPool({host:process.env.MYSQL_HOST,user:process.env.MYSQL_USER,database:process.env.MYSQL_DATABASE,password:process.env.MYSQL_PASSWORD,waitForConnections:!0,connectionLimit:10,maxIdle:10,idleTimeout:6e4,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0,charset:"utf8mb4"}),y=x.promise();var u=class{static addMoneyOnMatch(e){return i(this,null,function*(){var m,_,s;let[t]=yield y.query("SELECT * FROM VIEW_VERIFICAR_SE_EXISTE_PAGAMENTO_IN_PROCESSO;"),o=yield p.createPayment({transaction_amount:e,payment_method_id:"debit_card",payer:{email:"heuderdev@gmail.com"},installments:1});if(console.log(JSON.stringify(o,null,2)),((m=t[0])==null?void 0:m.id)!=null){let[r]=yield y.query("SELECT * FROM TB_ACUMULA_VALORES_CASO_AWARDS_DIFERENTE_IN_PROCESSING WHERE id = 1;"),c=Number((_=t[0])==null?void 0:_.subtract_premiums),R=c+e;console.log(Number((s=r[0])==null?void 0:s.amount)),console.log(c),console.log(R)}else console.log("RECURSO EM PROCESSO.");return{}})}};var f=class{static add(e,t){return i(this,null,function*(){let o=yield u.addMoneyOnMatch(1);return t.json(o)})}};0&&(module.exports={AwarsController});
