"use strict";var O=Object.create;var d=Object.defineProperty,y=Object.defineProperties,L=Object.getOwnPropertyDescriptor,C=Object.getOwnPropertyDescriptors,v=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,x=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var T=(t,e,s)=>e in t?d(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,g=(t,e)=>{for(var s in e||(e={}))N.call(e,s)&&T(t,s,e[s]);if(l)for(var s of l(e))G.call(e,s)&&T(t,s,e[s]);return t},w=(t,e)=>y(t,C(e));var _=(t,e)=>{for(var s in e)d(t,s,{get:e[s],enumerable:!0})},f=(t,e,s,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of v(e))!N.call(t,r)&&r!==s&&d(t,r,{get:()=>e[r],enumerable:!(a=L(e,r))||a.enumerable});return t};var b=(t,e,s)=>(s=t!=null?O(x(t)):{},f(e||!t||!t.__esModule?d(s,"default",{value:t,enumerable:!0}):s,t)),q=t=>f(d({},"__esModule",{value:!0}),t);var m=(t,e,s)=>new Promise((a,r)=>{var p=o=>{try{i(s.next(o))}catch(E){r(E)}},n=o=>{try{i(s.throw(o))}catch(E){r(E)}},i=o=>o.done?a(o.value):Promise.resolve(o.value).then(p,n);i((s=s.apply(t,e)).next())});var D={};_(D,{UsersEntities:()=>u});module.exports=q(D);var U=require("jsonwebtoken"),c=require("bcrypt");var F=require("dotenv/config"),h={jwt:{secret:process.env.JWT_STRING||"default",expiresIn:"365d"}};var Y=require("dotenv/config"),M=b(require("mysql2")),H=M.default.createPool({host:process.env.MYSQL_HOST,user:process.env.MYSQL_USER,database:process.env.MYSQL_DATABASE,password:process.env.MYSQL_PASSWORD,waitForConnections:!0,connectionLimit:10,maxIdle:10,idleTimeout:6e4,queueLimit:0,enableKeepAlive:!0,keepAliveInitialDelay:0,charset:"utf8mb4"}),I=H.promise();var S=({error:t=!1,message:e="OPERA\xC7\xC3O EXECUTADA COM SUCESSO.",path:s,data:a,code:r=200})=>({code:r,error:t,message:e.toUpperCase(),path:s.toUpperCase(),data:a});var u=class{static signIn(e,s){return m(this,null,function*(){let[a]=yield I.query("SELECT * FROM users AS u WHERE u.email = ?",[e]),r=a[0];if(r){let[p]=yield I.query("SELECT * FROM establishments AS e WHERE e.id = ?",[r==null?void 0:r.id]),n=p[0];if(!(0,c.compareSync)(s,r==null?void 0:r.password))return S({code:401,error:!0,path:"USERSENTITIES:SIGNIN",message:"E-MAIL OU SENHA INV\xC1LIDOS.",data:{}});delete r.password,delete r.recover_password;let o=w(g({},r),{establishmentId:n==null?void 0:n.id}),{secret:E,expiresIn:A}=h.jwt,R=(0,U.sign)({user:JSON.stringify(o)},E,{expiresIn:A});return S({path:"USERSENTITIES:SIGNIN",data:{dataUser:o,token:R}})}else return S({code:401,error:!0,path:"USERSENTITIES:SIGNIN",message:"Email e/ou senha incorretos",data:[]})})}static signUp(e,s){return m(this,null,function*(){let[a]=yield I.query("SELECT U.email FROM users AS U WHERE U.email = ? LIMIT 1",[e]);if(a[0]!=null)return S({code:406,error:!0,path:"USERSENTITIES:SIGNIN",message:"Esse E-mail j\xE1 est\xE1 cadastrado no sistemas.",data:{}});{let p=(0,c.genSaltSync)(10),n=(0,c.hashSync)(s,p),[i]=yield I.query("INSERT INTO users (email,password) VALUES (?,?);",[e,n]);return S({path:"USERSENTITIES:SIGNIN",data:{rows:i}})}})}};0&&(module.exports={UsersEntities});
